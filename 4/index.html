<!DOCTYPE html>
<html>
<head>
    <title>Project 4</title>
    <style>
        body {
            font-family: Times New Roman, Arial, sans-serif;
            margin: 20px;
        }

        <!-- Following code for CSS style is adapted from W3 Schools. https://www.w3schools.com/howto/howto_css_images_side_by_side.asp
        and Stack Overflow
        https://stackoverflow.com/questions/61637178/how-to-center-multiple-figure-elements-in-one-row-->
        * {
      box-sizing: border-box;
    }
    
    .column {
      float: left;
      width: 50%;
      padding: 5px;
    }
    
    
    .row {
      padding-bottom: 50px;
      display: flex;
        text-align: center;
        flex-direction: row;
        justify-content: center;
    }

    img {
        width: 100%;
        height: auto
        
    }
    </style>
</head>
<body>
    <h1>Welcome to My CS180 Project 4!</h1>
    <a href = "../index.html"> My CS180 Personal Project Home Page </a>
    <strong> <br> Name: Zach Turner <br> SID: 3036700008 </strong>
    <h3>Introduction</h3>
    <p>
        This project, like previous projects, explores image warping. However, this time we are doing so for the purpose of creating image mosiacs. The key to accomplish this to take photos from the same Center of Projection (where the camera lens is located in the same place) with varying angles of imagery. Thus, these photos will be related by a perspective transformation, also known as a homography. This implies that we can warp the images into a mutual shape such that the images align and the resulting image has a wider field of view. Accomplishing said transformation and warping the images together into a mosiac is the goal of this project. 
    </p>

    <h3>Taking the Images</h3>
    <p>
        The most important trait of images used in this process is that they have the same center of projection. I am personally using various sets of images of nature scenes captued around the Berkeley hills. Below are the images I will be using.
    </p>

    <div class = "row">
        <figure>
            <img src = "./media/photoseq1/0.jpg">
        </figure>
        <figure>
            <img src = "./media/photoseq1/1.jpg">
        </figure>
    </div>
    <div class = "row">
        <figure>
            <img src = "./media/photoseq2/0.jpg">
        </figure>
        <figure>
            <img src = "./media/photoseq2/1.jpg">
        </figure>
    </div>
    <div class = "row">
        <figure>
            <img src = "./media/photoseq3/0.jpg">
        </figure>
        <figure>
            <img src = "./media/photoseq3/1.jpg">
        </figure>
    </div>

    <h3>Recovering Homographies</h3>
    <p>
        When we will later warp images into mosaics, we need a homography to align the images. A homography is a perspective transformation that tells how to map the domain of one image such that the image will now align with another image taken from the same center of projection. Mathematically, a homography can be represented as a 3x3 matrix the maps coordinates [x, y, 1] in one image to [wx', wy', w] in another image, where x', y' are the coordinates in the warped image. To accomplish this, we can define coorespondances between the images that we will use to solve for the homography matrix. To do so, I used this tool provided by course staff: <a href = "https://cal-cs180.github.io/fa23/hw/proj3/tool.html"> Click Here to Find the Tool. </a>
        <br><br>
        Once we know the corresponding images, we can solve for the homography matrix shown below (my calculations are on paper)!
    </p>

    <img src = "./media/PXL_20241020_004707780.MP.jpg">

    <p>
        Note that the homography matrix has 8 degrees of freedom. Thus, we need 4 correspondances to solve the system since each correspondance provides 2 equations. However, since points are selected by humans(ie myself), there may be a few pixels of error in each correspondance. Thus, our data is noisy so it is better to use more correspondance points to constrain our solution and make it more robust to noise. Parallels can be made here to Statistical Learning Theory. Thus, I would generally select around 10 correspondance points for each pair of images. Thus, we want to solve the equation Ax = b where A has dimensions (~20, 8) is the matrix of equations I found above on paper, x is the coefficients a, b, ... , h with 8 dimensions, and b is the correspondance points in the other image (around 20 dimenisonal). Thus, the system will be overconstrained. Thus, I use least squares to find the least squares solution for a, ... , h.
        Now, we have our homography matrix. 
        <br><br>
    </p>
    <h3>Warping Images</h3>
    <p>
        Equipped with our homography matrix, we can now transform each point in the domain of one image to the corresponding place in the other image such that the images align through the equation H @ [x, y, 1] = [wx', wy', w], where H is the homography matrix. 
        Since we ultimately want x', y', we divide by w to find x',y'. It is often the case that some of x', y' will be negative. Thus, I add the minimum value over i of xi', yi' to each point, ensuring that all xi', yi' >= 0. Thus, now all x', y' define positions within an image. Thus, I find the size of the resulting image and interpolate the values at each x', y' to get the original image from the perspective of another image, which will be useful when we make the mosaics.
        <br><br>
        To warp images, I find all coordinates in the to be warped image, then warp them to their new location using the method in the paragraph above. Then, I interpolate the values at each of the new coordinates using griddata. This is all accomplished with 0 for loops. Since I use 'nearest' interpolation for performance reasons, outside of the convex polygon where the warped images lies are non-sense values filled in by griddata. Thus, I also find the convex polygon that contains the warped image, and I set all pixels outside of the warped image to 0 to eliminate artifacts from griddata. Given on the parameter values passed to warpImage, I will also find the polygon that would contain the overlap of the warped image and the neighbouring unwarped image, which is useful when making image mosaics. 
    </p>


</body>
</html>
